Project trueauth {
    database_type: 'PostgreSQL'
    Note: '''
    # TrueAuth Database
    '''
}


Table users as U {
  id UUID [pk, not null, note: 'user id', default: `uuid_generate_v4()`]
  email VARCHAR(255) [unique, not null, note: 'unique email']
  username VARCHAR(255) [unique, not null, note: 'unique username']
  password VARCHAR(255) [not null, note: 'hashed password']
  firstname VARCHAR(255) [default: '', not null, note: 'first name can be empty']
  lastname VARCHAR(255) [default:'', not null, note: 'last name can be empty']
  verified BOOL [not null, default: false, note: 'email verified or not']
  blocked BOOL [not null, default: false, note: 'user blocked or not']
  created_at TIMESTAMPTZ [not null, default: `now()`, note:'created at timestamp']
  updated_at TIMESTAMPTZ [not null, default: `now()`, note: 'last updated at timestamp']

  Indexes {
    firstname
    lastname
  }
}

Table sessions as S {
  id UUID [pk, not null, note: 'refresh token id']
  refresh_token TEXT [not null, note: 'refresh token']
  access_token_id UUID [unique, not null, note:'access token id']
  access_token TEXT [not null, note:'short life access token']
  user_id UUID [ref: > U.id, not null, note: 'user id to whom this session is assigned to']
  blocked BOOL [not null, default: 'false', note:'session is blocked or not']
  access_token_expires_at TIMESTAMPTZ [not null, note: 'expiration time of access token']
  refresh_token_expires_at TIMESTAMPTZ [not null, note: 'expiration time of a refresh token']
  created_at TIMESTAMPTZ [not null, default: `now()`, note: 'created at timestamp of this session']
  updated_at TIMESTAMPTZ [not null, default: `now()`, note: 'last updated at timestamp of this session']
  
  Indexes {
    user_id
    access_token_id
  }
}



Table iprecords as IP {
  id UUID [pk, ref: > U.id, not null, note:'user uuid']
  allowed_ips TEXT[] [note: 'list of all allowed ip address for this user']
  blocked_ips TEXT[] [note: 'list of all blocked ip address for this user']
  code TEXT [not null, default: '', note: 'confirmation code sent to email for allowing new ips']
  code_expires_at TIMESTAMPTZ [not null, note: 'confirmation code expires at']
  created_at TIMESTAMPTZ [not null, default: `now()`, note: 'created at timestamp of this session']
  updated_at TIMESTAMPTZ [not null, default: `now()`, note: 'last updated at timestamp of this session']
}


Table emailrecords as E {
  id UUID [pk, not null, note:'email uuid', default: `uuid_generate_v4()`]
  email VARCHAR(255) [unique, not null, note: 'email address']
  user_id UUID [ref: > U.id, not null, note: 'user id']
  verified BOOL [not null, default: FALSE, note: 'email verified or not']
  code TEXT [not null, default: '', note: 'confirmation code sent to email for email verification']
  code_expires_at TIMESTAMPTZ [not null, note: 'email confirmation code expires at']
  created_at TIMESTAMPTZ [not null, default: `now()`, note: 'created at timestamp']
  updated_at TIMESTAMPTZ [not null, default: `now()`, note: 'last updated at timestamp']
}
